# git分支

## 1.分支简介

​	git保存的不是文件的变化或差异，而是一系列不同时刻的快照信息(git使用glob对象来保存快照信息)。

​	git的提交操作会被保存为一个提交对象，其内容包含：

- 包含一个指向暂存内容的指针

- 包含了提交的基本信息，如提交者的姓名、邮箱等

- 包含了一个指向父提交对象的指针(首次提交时没有该指针)

  在进行` git commit`提交操作时，git在内部帮我们做了这些事：

- 计算每个子目录的校验和，并将这些校验和保存为一个树对象

- 然后git创建一个本次提交的提交对象，然后有一个指针引指向上面的树对象

  所以，git仓库中一般存在5个对象：3个blob快照对象、一个树对象、一个commit提交对象。

![image-20200911102755674](git分支.assets/image-20200911102755674.png)

如果是仓库的第一次提交，那么该提交对象没有指向父对象的指针。如果提交后做了一些修改然后继续提交，那么此时该提交对象就包含一个指向父对象的指针。

![image-20200911103155025](git分支.assets/image-20200911103155025.png)

​	git的分支，本质上仅仅是指向提交对象的可变指针。

​	git的master分支和其它分支并无区别，仅仅只是git在默认的时候创建了它，并且很少有人去改动它的名称。而分支会随着每次提交操作版本的提升而向前移动。

​	![image-20200911103610006](git分支.assets/image-20200911103610006.png)

## 2.分支创建

​	git创建的分支其实就是在当前提交对象上创建了一个新的指针。

```powershell
#创建一个testing分支
git branch testing
```

![image-20200911140720825](git分支.assets/image-20200911140720825.png)

git通过一个叫HEAD的指针来标识当前所处于的分支。

![image-20200911140854886](git分支.assets/image-20200911140854886.png)

## 3.分支切换

​	切换分支使用` git checkout`命令。

```powershell
#切换分支到testing
git checkout testing
```

切换分支后，HEAD指针就指向当前所在的分支。

​	如果此时我们在当前分支想做一些修改，并进行提交，此时HEAD指针及当前testing分支都会向前移动指向新的提交对象，而此时master分支还指向原先的提交对象，我们做一下修改然后通过` git log --decorate`看一下。

![image-20200911142508873](git分支.assets/image-20200911142508873.png)

此时git中的结构如图：

![image-20200911142547325](git分支.assets/image-20200911142547325.png)

而如果此时切换回master分支，可以再通过`git log --decorate`来看一下。

![image-20200911143600584](git分支.assets/image-20200911143600584.png)

因为testing分支指向的提交已经脱离了master主干，所以这里看不到testing分支上的提交信息，但是此时可以看到HEAD指针又指向了master分支，此时的结构为：

![image-20200911143732774](git分支.assets/image-20200911143732774.png)

**注意：切换分支会导致工作目录中的文件被改变。如果是切换会一个较旧的分支，工作目录会恢复到该分支最后一次提交时的样子。**

如果此时在master分支上做一些修改并提交，此时的git结构为：

![image-20200911144037655](git分支.assets/image-20200911144037655.png)

git结构出现了分叉，此时运用` checkout`命令可以在两个分支之间随意切换。

运用` git log --decorate --all --graph`命令可以帮我们分析此时git的指向结构：

![image-20200911144424572](git分支.assets/image-20200911144424572.png)

由于git的分支实质上仅是包含所指提交对象的校验和(长度为40的SHA-1字符串)，所以它的创建和销毁都非常高效。创建一个分支就相当于在一个文件中写入41个字符串，40的校验和和1个换行符。

```powershell

#创建testing2分支并立即切换到该分支下
git checkout -b testing2
```

![image-20200911144920279](git分支.assets/image-20200911144920279.png)